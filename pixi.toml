[workspace]
authors = ["Jermiah Joseph <jermiahjoseph98@gmail.com>"]
channels = ["conda-forge"]
name = "dot-agents"
platforms = ["osx-arm64", "linux-64"]
version = "0.1.0"

[tasks]
install-opencode = {cmd = "bin/install_opencode.sh", description = "Install OpenCode CLI tool to $HOME/.local/bin"}
stow = { cmd = "stow --target=$HOME --dotfiles src -vv", depends-on = ["check-stow"], description = "Stow dotfiles to home directory" }
unstow = { cmd = "stow --target=$HOME --dotfiles --delete src -vv", depends-on = ["check-stow"], description = "Unstow dotfiles from home directory" }

[feature.git-cliff.dependencies]
git-cliff = "*"

[feature.git-cliff.tasks]
changelog = {cmd = "git-cliff --config cliff.toml --latest --strip header", description = "Generate changelog for latest release", env = { GITHUB_REPO = "jjjermiah/dot-agents" }}

# Platform-specific dependencies: stow only on Linux (via conda-forge)
[target.linux-64.dependencies]
stow = "*"

# Platform-specific check-stow tasks
[target.linux-64.tasks]
check-stow = { cmd = "which stow", description = "Verify stow is available (Linux - installed via pixi)" }

[target.osx-arm64.tasks]
check-stow = { cmd = "which stow || (echo 'ERROR: stow not found. Install with: brew install stow' && exit 1)", description = "Verify stow is available (macOS - requires brew install stow)" }

[environments]
default = { features = [], solve-group = "default" }
release = { features = ["git-cliff"], solve-group = "default" }
